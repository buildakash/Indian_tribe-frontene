<!-- /index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Indian Tribe</title>
    <link
      rel="shortcut icon"
      href="./assets/images/logo/favicon.ico"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="./assets/css/swiper-bundle.min.css" />
    <link rel="stylesheet" href="./assets/css/style.css" />
    <link rel="stylesheet" href="./dist/output-scss.css" />
    <link rel="stylesheet" href="./dist/output-tailwind.css" />
    <link rel="stylesheet" href="./assets/css/user-experience.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkfWcKqj8R5hXPSbR6v9QfGZQ8G4wY4XGZk2Y9wQJf8b+3r9e2z5y3Uqw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>

  <body>
    <!-- Placeholders for Components -->
    <div id="top-nav-placeholder"></div>
    <div id="header-placeholder"></div>
    <div id="slider-placeholder"></div>
    <div id="benefits-placeholder"></div>
    <div id="promo-banners-placeholder"></div>
    <div id="weekly-highlights-placeholder"></div>
    <div id="featured-product-placeholder"></div>
    <div id="sale-banner-placeholder"></div>
    <div id="best-sellers-placeholder"></div>
    <div id="testimonials-placeholder"></div>
    <div id="news-block-placeholder"></div>
    <div id="footer-placeholder"></div>
    <div id="modals-placeholder"></div>

    <!-- Scroll to Top Button -->
    <a class="scroll-to-top-btn" href="#top-nav"
      ><i class="ph-bold ph-caret-up"></i
    ></a>

    <!-- User Session Management -->
    <script src="./assets/js/user-session-manager.js"></script>
    <script src="./assets/js/user-homepage-manager.js"></script>
    <script src="./assets/js/header-profile-manager.js"></script>
    
    <!-- SCRIPT TO LOAD COMPONENTS -->
   <script>
  document.addEventListener("DOMContentLoaded", () => {
    // Initialize user homepage manager
    if (window.userHomepageManager) {
      window.userHomepageManager.init();
    }
    const loadComponent = (component) =>
      fetch(component).then((res) => res.ok ? res.text() : Promise.reject(component));

    const components = [
      { url: "components/top-nav.html", id: "top-nav-placeholder" },
      { url: "components/header.html", id: "header-placeholder" },
      { url: "components/slider.html", id: "slider-placeholder" },
      { url: "components/benefits.html", id: "benefits-placeholder" },
      { url: "components/promo-banners.html", id: "promo-banners-placeholder" },
      { url: "components/weekly-highlights.html", id: "weekly-highlights-placeholder" },
      { url: "components/featured-product.html", id: "featured-product-placeholder" },
      { url: "components/sale-banner.html", id: "sale-banner-placeholder" },
      { url: "components/best-sellers.html", id: "best-sellers-placeholder" },
      { url: "components/testimonials.html", id: "testimonials-placeholder" },
      { url: "components/news-block.html", id: "news-block-placeholder" },
      { url: "components/footer.html", id: "footer-placeholder" },
      { url: "components/modals.html", id: "modals-placeholder" },
    ];

    const loadScript = (src) =>
      new Promise((resolve, reject) => {
        const s = document.createElement("script");
        s.src = src;
        s.defer = false;            // ensure execution as soon as it loads
        s.onload = resolve;
        s.onerror = () => reject(new Error("Failed to load " + src));
        document.body.appendChild(s);
      });

    // 1) Inject all components
    Promise.all(components.map(c => loadComponent(c.url)))
      .then((htmls) => {
        htmls.forEach((html, i) => {
          // Replace placeholder with the component HTML
          const ph = document.getElementById(components[i].id);
          if (ph) ph.outerHTML = html;
        });
      })
      .then(async () => {
        // 2) Load libraries in strict order
        await loadScript("./assets/js/phosphor-icons.js");
        await loadScript("./assets/js/swiper-bundle.min.js");

        // 3) Load your app scripts (order matters if they depend on each other)
        await loadScript("./assets/js/main.js");
        await loadScript("./assets/js/toast.js");
        await loadScript("./assets/js/config.js");
        await loadScript("./assets/js/utils.js");
        await loadScript("./assets/js/validators.js");
        await loadScript("./assets/js/api.auth.js");
        await loadScript("./assets/js/ui.auth.js");
        await loadScript("./assets/js/controller.auth.js");

        // 4) Now that DOM has your components and Swiper exists, initialize UI
        if (typeof window.initUI === "function") {
          window.initUI(); // <- will create your Swiper instances, bind events, etc.
        }

        // 5) Initialize header profile manager
        if (window.headerProfileManager) {
          console.log('ðŸš€ Initializing header profile manager from index.html');
          window.headerProfileManager.init();
        } else {
          console.error('âŒ Header profile manager not found!');
        }

        // 6) Dispatch components loaded event
        document.dispatchEvent(new CustomEvent('components:loaded'));

        // 7) Additional initialization after a delay to ensure everything is ready
        setTimeout(() => {
          console.log('ðŸ”„ Additional initialization check...');
          if (window.headerProfileManager) {
            console.log('ðŸ”„ Re-initializing header profile manager...');
            window.headerProfileManager.init();
          }
        }, 2000);

        // 8) Add global test function for debugging
        window.testHeaderProfile = function() {
          console.log('ðŸ§ª Testing header profile manager...');
          if (window.headerProfileManager) {
            window.headerProfileManager.forceUpdateModal();
          } else {
            console.error('âŒ Header profile manager not available');
          }
        };
      })
      .catch((err) => console.error("Boot error:", err));
  });
</script>

  </body>
</html>
