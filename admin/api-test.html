<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="admin-style.css">
</head>
<body class="bg-light">
    <div class="container py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">
                    <i class="fas fa-flask text-primary me-2"></i>
                    API Test Dashboard
                </h1>
                
                <!-- Test Results -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Test Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="testResults">
                            <div class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Running API tests...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manual Test Section -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Manual API Tests</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <h6>Test Categories API</h6>
                                <button class="btn btn-primary btn-sm" onclick="testCategoriesAPI()">
                                    <i class="fas fa-play"></i> Test Get Categories
                                </button>
                            </div>
                            <div class="col-md-6">
                                <h6>Test Products API</h6>
                                <button class="btn btn-primary btn-sm" onclick="testProductsAPI()">
                                    <i class="fas fa-play"></i> Test Get Products
                                </button>
                            </div>
                            <div class="col-md-6">
                                <h6>Test Orders API</h6>
                                <button class="btn btn-primary btn-sm" onclick="testOrdersAPI()">
                                    <i class="fas fa-play"></i> Test Get Orders
                                </button>
                            </div>
                            <div class="col-md-6">
                                <h6>Test Blogs API</h6>
                                <button class="btn btn-primary btn-sm" onclick="testBlogsAPI()">
                                    <i class="fas fa-play"></i> Test Get Blogs
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup Modal System -->
    <div id="popupModal" class="popup-modal">
        <div class="popup-content">
            <div class="popup-header">
                <h5 class="popup-title" id="popupTitle">Notification</h5>
                <button class="popup-close" id="popupClose">&times;</button>
            </div>
            <div class="popup-body">
                <div class="popup-icon" id="popupIcon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <p class="popup-message" id="popupMessage">Message content</p>
            </div>
            <div class="popup-footer">
                <button class="btn btn-primary" id="popupOk">OK</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = "http://localhost/Indian%20Tribe/Backend_php/routes/shop";
        
        // Get test data from localStorage
        const shopId = localStorage.getItem('shop_id');
        const userId = localStorage.getItem('user_id');
        
        console.log('Shop ID:', shopId);
        console.log('User ID:', userId);

        // Run all tests on page load
        document.addEventListener('DOMContentLoaded', () => {
            runAllTests();
        });

        async function runAllTests() {
            const results = [];
            
            // Test 1: Get Categories
            results.push(await testAPI('Get Categories', `${API_BASE}/get_categories.php?shop_id=${shopId}`));
            
            // Test 2: Get Products
            results.push(await testAPI('Get Products', `${API_BASE}/get_my_products.php?shop_id=${shopId}`));
            
            // Test 3: Get Orders (Admin view)
            results.push(await testAPI('Get Orders (Admin)', `${API_BASE}/get_orders.php?shop_id=${shopId}`));
            
            // Test 4: Get Orders (User view)
            results.push(await testAPI('Get Orders (User)', `${API_BASE}/get_orders.php?user_id=${userId}`));
            
            // Test 5: Get Blogs
            results.push(await testAPI('Get Blogs', `${API_BASE}/get_blogs.php`));
            
            displayResults(results);
        }

        async function testAPI(name, url) {
            try {
                console.log(`Testing ${name}: ${url}`);
                const response = await fetch(url);
                const data = await response.json();
                
                return {
                    name: name,
                    url: url,
                    status: response.ok ? 'success' : 'error',
                    statusCode: response.status,
                    data: data,
                    error: null
                };
            } catch (error) {
                return {
                    name: name,
                    url: url,
                    status: 'error',
                    statusCode: 0,
                    data: null,
                    error: error.message
                };
            }
        }

        function displayResults(results) {
            const container = document.getElementById('testResults');
            let html = '';
            
            results.forEach(result => {
                const statusClass = result.status === 'success' ? 'success' : 'danger';
                const statusIcon = result.status === 'success' ? 'check-circle' : 'times-circle';
                
                html += `
                    <div class="alert alert-${statusClass} mb-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">
                                    <i class="fas fa-${statusIcon} me-2"></i>
                                    ${result.name}
                                </h6>
                                <small class="text-muted">${result.url}</small>
                                <div class="mt-2">
                                    <span class="badge bg-${statusClass}">Status: ${result.statusCode}</span>
                                    ${result.data ? `<span class="badge bg-info ms-2">Data: ${JSON.stringify(result.data).substring(0, 100)}...</span>` : ''}
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline-secondary" onclick="showDetails('${result.name}', ${JSON.stringify(result).replace(/"/g, '&quot;')})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        ${result.error ? `<div class="mt-2 text-danger"><small>Error: ${result.error}</small></div>` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function showDetails(name, result) {
            const message = `Status: ${result.status}\nStatus Code: ${result.statusCode}\n\nData:\n${JSON.stringify(result.data, null, 2)}\n\nError: ${result.error || 'None'}`;
            showPopup(name, message, result.status === 'success' ? 'success' : 'error');
        }

        // Individual test functions
        async function testCategoriesAPI() {
            const result = await testAPI('Get Categories (Manual)', `${API_BASE}/get_categories.php?shop_id=${shopId}`);
            showDetails('Get Categories', result);
        }

        async function testProductsAPI() {
            const result = await testAPI('Get Products (Manual)', `${API_BASE}/get_my_products.php?shop_id=${shopId}`);
            showDetails('Get Products', result);
        }

        async function testOrdersAPI() {
            const result = await testAPI('Get Orders (Manual)', `${API_BASE}/get_orders.php?shop_id=${shopId}`);
            showDetails('Get Orders', result);
        }

        async function testBlogsAPI() {
            const result = await testAPI('Get Blogs (Manual)', `${API_BASE}/get_blogs.php`);
            showDetails('Get Blogs', result);
        }

        // Popup function for API test page
        function showPopup(title, message, type = 'info', callback = null) {
            const modal = document.getElementById('popupModal');
            const titleEl = document.getElementById('popupTitle');
            const messageEl = document.getElementById('popupMessage');
            const iconEl = document.getElementById('popupIcon');
            const okBtn = document.getElementById('popupOk');
            const closeBtn = document.getElementById('popupClose');

            // Set content
            titleEl.textContent = title;
            messageEl.textContent = message;

            // Set icon and colors based on type
            const iconMap = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };

            iconEl.className = `popup-icon ${type}`;
            iconEl.innerHTML = `<i class="${iconMap[type] || iconMap.info}"></i>`;

            // Show modal
            modal.classList.add('show');

            // Close handlers
            const closeModal = () => {
                modal.classList.remove('show');
                if (callback) callback();
            };

            okBtn.onclick = closeModal;
            closeBtn.onclick = closeModal;
            
            // Close on backdrop click
            modal.onclick = (e) => {
                if (e.target === modal) closeModal();
            };

            // Close on Escape key
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                    document.removeEventListener('keydown', handleEscape);
                }
            };
            document.addEventListener('keydown', handleEscape);
        }
    </script>
</body>
</html>
